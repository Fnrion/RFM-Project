<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zou Jiaxun">

<title>Makert Survey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="site_libs/vis-9.1.0/vis-network.min.js"></script>
<script src="site_libs/visNetwork-binding-2.1.2/visNetwork.js"></script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./Picture/Logo1.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./Market.html" aria-current="page"> 
<span class="menu-text">Market Survey</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Wealth Management.qmd"> 
<span class="menu-text">Wealth Management</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://twitter.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/Fnrion/RFM-Project">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://bugs.com">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">1 <strong>Overview</strong></a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">1.1 <strong>Background</strong></a></li>
  <li><a href="#data-processing" id="toc-data-processing" class="nav-link" data-scroll-target="#data-processing"><strong>1.2 Data Processing</strong></a></li>
  <li><a href="#implementation-building-the-spider" id="toc-implementation-building-the-spider" class="nav-link" data-scroll-target="#implementation-building-the-spider">Implementation: Building the Spider</a></li>
  <li><a href="#targeted-search-keywords" id="toc-targeted-search-keywords" class="nav-link" data-scroll-target="#targeted-search-keywords">Targeted Search Keywords</a></li>
  <li><a href="#data-collection-process" id="toc-data-collection-process" class="nav-link" data-scroll-target="#data-collection-process">Data Collection Process</a></li>
  <li><a href="#data-transformation" id="toc-data-transformation" class="nav-link" data-scroll-target="#data-transformation">Data Transformation</a></li>
  <li><a href="#data-clean" id="toc-data-clean" class="nav-link" data-scroll-target="#data-clean"><strong>1.3 Data Clean</strong></a></li>
  <li><a href="#text-cleaning" id="toc-text-cleaning" class="nav-link" data-scroll-target="#text-cleaning">Text Cleaning</a></li>
  <li><a href="#keyword-frequency" id="toc-keyword-frequency" class="nav-link" data-scroll-target="#keyword-frequency">Keyword Frequency</a></li>
  </ul></li>
  <li><a href="#text-analysis" id="toc-text-analysis" class="nav-link" data-scroll-target="#text-analysis">2 <strong>Text Analysis</strong></a>
  <ul class="collapse">
  <li><a href="#word-cloud" id="toc-word-cloud" class="nav-link" data-scroll-target="#word-cloud"><strong>2.1 Word Cloud</strong></a></li>
  <li><a href="#visualizing-high-frequency-terms" id="toc-visualizing-high-frequency-terms" class="nav-link" data-scroll-target="#visualizing-high-frequency-terms">Visualizing High-Frequency Terms</a></li>
  <li><a href="#sentiment-analysis" id="toc-sentiment-analysis" class="nav-link" data-scroll-target="#sentiment-analysis"><strong>2.2 Sentiment Analysis</strong></a></li>
  <li><a href="#network-analysis" id="toc-network-analysis" class="nav-link" data-scroll-target="#network-analysis"><strong>2.3 Network Analysis</strong></a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">3 <strong>Conclusion</strong></a>
  <ul class="collapse">
  <li><a href="#final-takeaways-why-do-chinese-hnwis-move-their-wealth-to-singapore" id="toc-final-takeaways-why-do-chinese-hnwis-move-their-wealth-to-singapore" class="nav-link" data-scroll-target="#final-takeaways-why-do-chinese-hnwis-move-their-wealth-to-singapore">Final Takeaways: Why Do Chinese HNWIs Move Their Wealth to Singapore?</a>
  <ul class="collapse">
  <li><a href="#key-findings" id="toc-key-findings" class="nav-link" data-scroll-target="#key-findings">Key Findings:</a></li>
  <li><a href="#why-this-method-worked" id="toc-why-this-method-worked" class="nav-link" data-scroll-target="#why-this-method-worked">Why This Method Worked:</a></li>
  </ul></li>
  <li><a href="#strategic-implications" id="toc-strategic-implications" class="nav-link" data-scroll-target="#strategic-implications">Strategic Implications</a>
  <ul class="collapse">
  <li><a href="#for-wealth-advisors" id="toc-for-wealth-advisors" class="nav-link" data-scroll-target="#for-wealth-advisors">For Wealth Advisors</a></li>
  <li><a href="#for-life-inc" id="toc-for-life-inc" class="nav-link" data-scroll-target="#for-life-inc">For Life Inc</a></li>
  <li><a href="#for-company-strategy" id="toc-for-company-strategy" class="nav-link" data-scroll-target="#for-company-strategy">For Company Strategy</a></li>
  <li><a href="#for-survey-research" id="toc-for-survey-research" class="nav-link" data-scroll-target="#for-survey-research">For Survey &amp; Research</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Makert Survey</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zou Jiaxun </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>1 <strong>Overview</strong></h1>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">1.1 <strong>Background</strong></h2>
<p>To effectively organize and communicate the complex thought process behind why Chinese HNW individuals move their money to Singapore, I created Flowchart. This flowchart helps to:</p>
<ul>
<li><p>Visually map the key motivations (such as wealth management, tax benefits, lifestyle advantages, and legacy planning) that drive this financial movement.</p></li>
<li><p>Clarify the relationships between client needs, Singapore’s value proposition, and the strategic advisory angles we can take.</p></li>
<li><p>Support client-facing engagement by simplifying the narrative for Life Inc advisors</p></li>
<li><p>Guide my survey design and presentation content, ensuring all relevant themes—such as trends, preferences, and asset relocation methods—are covered logically and comprehensively.</p></li>
</ul>
<p>It acts as both a research framework and a client communication tool to align our understanding and offerings with the target market’s aspirations.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Picture/Flowchart1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="data-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-processing"><strong>1.2 Data Processing</strong></h2>
<p>To support the research in Flowchart, I developed a custom web crawler to systematically collect qualitative and contextual data from Chinese-language sources such as forums (e.g., Zhihu, Xueqiu), financial news sites (e.g., Eastern Wealth), and financial blogs. These platforms offer authentic discussions and opinions from Chinese citizens regarding overseas wealth movement—especially to Singapore.</p>
<p>My spider focused on keywords that map directly to the key branches of the flowchart, such as:</p>
<ul>
<li><p>“新加坡 财富管理” (Singapore wealth management)</p></li>
<li><p>“中国人移民新加坡” (Chinese migration to Singapore)</p></li>
<li><p>“税务优化 新加坡” (Tax optimization Singapore)</p></li>
<li><p>“资产配置 海外” (Offshore asset allocation)</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why choose spider instead of survey
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Understand Real Conversations First</strong>: The spider captures what people are already saying online, so I don’t assume or guess their opinions.</li>
<li><strong>Gather Rich and Honest Insights</strong>: Online posts reveal detailed reasons, emotions, and comparisons that people may not share in surveys.</li>
<li><strong>Reach More People Easily</strong>: It’s hard to get high-net-worth individuals to answer surveys, but the spider can access public content instantly.</li>
<li><strong>Build a Better Survey Later</strong>: By analyzing online themes first, I can design a more focused and relevant survey based on real concerns.</li>
</ul>
</div>
</div>
</section>
<section id="implementation-building-the-spider" class="level2">
<h2 class="anchored" data-anchor-id="implementation-building-the-spider">Implementation: Building the Spider</h2>
<p>We implemented a Python-based web crawler using the SerpAPI platform to scrape real-time search results. The following code initializes the necessary libraries and parameters used in the process.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openpyxl</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jieba</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 用户配置区域</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>SERPAPI_KEY <span class="op">=</span> <span class="st">"84c798a8d45d1e7cae0b18df778ac06bf2c6169f0249e40756aea0b9d6cd4749"</span>  </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>RESULTS_PER_KEYWORD <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>DELAY_BETWEEN_REQUESTS <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>DELAY_BETWEEN_KEYWORDS <span class="op">=</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="targeted-search-keywords" class="level2">
<h2 class="anchored" data-anchor-id="targeted-search-keywords">Targeted Search Keywords</h2>
<p>The keywords used by the crawler are carefully chosen to reflect real user concerns about wealth migration. These terms guide the spider to relevant discussions, articles, and posts.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>keywords <span class="op">=</span> [</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"中国高净值人士 新加坡"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"中国富人 资产配置 新加坡"</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"中国富豪 为什么移民新加坡"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"中国高净值客户 离岸账户"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"新加坡 CRS 避税"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"中国 家族信托 新加坡"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"中国高净值人士 子女教育 新加坡"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"中国移民新加坡 财富管理"</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> serpapi_search(query, api_key, num<span class="op">=</span><span class="dv">20</span>, start<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"https://serpapi.com/search"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'q'</span>: query,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'api_key'</span>: api_key,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'engine'</span>: <span class="st">'google'</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'num'</span>: <span class="bu">min</span>(num, <span class="dv">100</span>),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'start'</span>: start,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'hl'</span>: <span class="st">'zh-cn'</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'gl'</span>: <span class="st">'cn'</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.get(url, params<span class="op">=</span>params)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        response.raise_for_status()</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response.json()</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"搜索请求失败: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_search_results(results, keyword):</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    extracted_results <span class="op">=</span> []</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    organic_results <span class="op">=</span> results.get(<span class="st">'organic_results'</span>, [])</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> organic_results:</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        result_info <span class="op">=</span> {</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'keyword'</span>: keyword,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'title'</span>: item.get(<span class="st">'title'</span>, <span class="st">''</span>),</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'url'</span>: item.get(<span class="st">'link'</span>, <span class="st">''</span>),</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">'snippet'</span>: item.get(<span class="st">'snippet'</span>, <span class="st">''</span>),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'displayed_link'</span>: item.get(<span class="st">'displayed_link'</span>, <span class="st">''</span>),</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">'position'</span>: item.get(<span class="st">'position'</span>, <span class="dv">0</span>),</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">'search_timestamp'</span>: datetime.now().strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S'</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        extracted_results.append(result_info)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> extracted_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search_keyword_with_pagination(keyword, api_key, total_results<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    all_results <span class="op">=</span> []</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    results_per_page <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> start <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, total_results, results_per_page):</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        remaining <span class="op">=</span> total_results <span class="op">-</span> start</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        num_to_get <span class="op">=</span> <span class="bu">min</span>(results_per_page, remaining)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    获取第 </span><span class="sc">{</span>start<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>start<span class="op">+</span>num_to_get<span class="sc">}</span><span class="ss"> 条结果..."</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> serpapi_search(keyword, api_key, num<span class="op">=</span>num_to_get, start<span class="op">=</span>start)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> results <span class="kw">or</span> <span class="st">'organic_results'</span> <span class="kw">not</span> <span class="kw">in</span> results:</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"没有更多结果"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        extracted <span class="op">=</span> extract_search_results(results, keyword)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        all_results.extend(extracted)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(extracted) <span class="op">&lt;</span> num_to_get:</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        time.sleep(DELAY_BETWEEN_REQUESTS)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> all_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"开始搜索..."</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"搜索关键词数量: </span><span class="sc">{</span><span class="bu">len</span>(keywords)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"每个关键词获取结果数: </span><span class="sc">{</span>RESULTS_PER_KEYWORD<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    all_search_results <span class="op">=</span> []</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, keyword <span class="kw">in</span> <span class="bu">enumerate</span>(keywords, <span class="dv">1</span>):</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"[</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(keywords)<span class="sc">}</span><span class="ss">] 搜索关键词: </span><span class="sc">{</span>keyword<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>            results <span class="op">=</span> search_keyword_with_pagination(keyword, SERPAPI_KEY, RESULTS_PER_KEYWORD)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            all_search_results.extend(results)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"找到 </span><span class="sc">{</span><span class="bu">len</span>(results)<span class="sc">}</span><span class="ss"> 个结果"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(keywords):</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"等待 </span><span class="sc">{</span>DELAY_BETWEEN_KEYWORDS<span class="sc">}</span><span class="ss"> 秒..."</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                time.sleep(DELAY_BETWEEN_KEYWORDS)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"错误: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"总共找到 </span><span class="sc">{</span><span class="bu">len</span>(all_search_results)<span class="sc">}</span><span class="ss"> 个结果"</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> all_search_results</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>search_results <span class="op">=</span> main()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-collection-process" class="level2">
<h2 class="anchored" data-anchor-id="data-collection-process">Data Collection Process</h2>
<p>The crawler iterates through each keyword, sends queries to SerpAPI, extracts content (including titles, URLs, and full texts), and saves them into a structured format for further processing. This automation ensures scalability and coverage.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> search_results:</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    df_full <span class="op">=</span> pd.DataFrame(search_results)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    df_unique <span class="op">=</span> df_full.drop_duplicates(subset<span class="op">=</span>[<span class="st">'url'</span>], keep<span class="op">=</span><span class="st">'first'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"原始结果: </span><span class="sc">{</span><span class="bu">len</span>(df_full)<span class="sc">}</span><span class="ss">，去重后: </span><span class="sc">{</span><span class="bu">len</span>(df_unique)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    timestamp <span class="op">=</span> datetime.now().strftime(<span class="st">'%Y%m</span><span class="sc">%d</span><span class="st">_%H%M%S'</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    df_simple <span class="op">=</span> df_unique[[<span class="st">'keyword'</span>, <span class="st">'title'</span>, <span class="st">'url'</span>, <span class="st">'search_timestamp'</span>]].copy()</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 保存到指定 Dataset</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    save_dir <span class="op">=</span> os.path.expanduser(<span class="st">"/Applications/SMU/Great Eastern/Personal Project/RFM Project/Dataset"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    os.makedirs(save_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    df_unique.to_csv(os.path.join(save_dir, <span class="ss">f"search_results_full_</span><span class="sc">{</span>timestamp<span class="sc">}</span><span class="ss">.csv"</span>), index<span class="op">=</span><span class="va">False</span>, encoding<span class="op">=</span><span class="st">'utf-8-sig'</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    df_simple.to_csv(os.path.join(save_dir, <span class="ss">f"search_results_simple_</span><span class="sc">{</span>timestamp<span class="sc">}</span><span class="ss">.csv"</span>), index<span class="op">=</span><span class="va">False</span>, encoding<span class="op">=</span><span class="st">'utf-8-sig'</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> pd.ExcelWriter(os.path.join(save_dir, <span class="ss">f"search_results_</span><span class="sc">{</span>timestamp<span class="sc">}</span><span class="ss">.xlsx"</span>), engine<span class="op">=</span><span class="st">'openpyxl'</span>) <span class="im">as</span> writer:</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        df_unique.to_excel(writer, sheet_name<span class="op">=</span><span class="st">'完整数据'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        df_simple.to_excel(writer, sheet_name<span class="op">=</span><span class="st">'简化数据'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"文件保存路径: </span><span class="sc">{</span>save_dir<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">数据预览:"</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df_simple.head())</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">每个关键词的结果数量:"</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df_unique[<span class="st">'keyword'</span>].value_counts())</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>()[<span class="st">'search_data'</span>] <span class="op">=</span> df_unique</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>()[<span class="st">'search_data_simple'</span>] <span class="op">=</span> df_simple</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">变量已加载: search_data, search_data_simple"</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"没有搜索结果"</span>)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>()[<span class="st">'search_data'</span>] <span class="op">=</span> pd.DataFrame()</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>()[<span class="st">'search_data_simple'</span>] <span class="op">=</span> pd.DataFrame()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-transformation" class="level2">
<h2 class="anchored" data-anchor-id="data-transformation">Data Transformation</h2>
<p>Once raw JSON responses are collected, we convert them into a tabular format using <code>pandas</code>. This step prepares the dataset for text cleaning and analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> chardet</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 文件路径设置</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>input_file <span class="op">=</span> <span class="st">"/Applications/SMU/Great Eastern/Personal Project/RFM Project/Dataset/search_results_20250706_192824.xlsx"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>output_file <span class="op">=</span> <span class="st">"/Applications/SMU/Great Eastern/Personal Project/RFM Project/Dataset/search_results_with_content.xlsx"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取简化数据工作表</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(input_file, sheet_name<span class="op">=</span><span class="st">"简化数据"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 正文提取函数</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_article_content(url, timeout<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.get(url, timeout<span class="op">=</span>timeout, headers<span class="op">=</span>{<span class="st">"User-Agent"</span>: <span class="st">"Mozilla/5.0"</span>})</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        detected <span class="op">=</span> chardet.detect(response.content)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        response.encoding <span class="op">=</span> detected[<span class="st">'encoding'</span>] <span class="kw">or</span> <span class="st">'utf-8'</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        soup <span class="op">=</span> BeautifulSoup(response.text, <span class="st">"html.parser"</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        paragraphs <span class="op">=</span> soup.find_all(<span class="st">'p'</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(p.get_text(strip<span class="op">=</span><span class="va">True</span>) <span class="cf">for</span> p <span class="kw">in</span> paragraphs)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> content <span class="cf">if</span> <span class="bu">len</span>(content) <span class="op">&gt;</span> <span class="dv">50</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 爬取内容</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"开始抓取正文内容..."</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"content"</span>] <span class="op">=</span> df[<span class="st">"url"</span>].<span class="bu">apply</span>(fetch_article_content)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"正文抓取完成，开始保存文件..."</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存为新的 Excel 文件</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>df.to_excel(output_file, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"文件已保存至：</span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-clean" class="level2">
<h2 class="anchored" data-anchor-id="data-clean"><strong>1.3 Data Clean</strong></h2>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 输入输出路径</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>input_file <span class="op">=</span> <span class="st">"/Applications/SMU/Great Eastern/Personal Project/RFM Project/Dataset/search_results_with_content.xlsx"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>output_file <span class="op">=</span> <span class="st">"/Applications/SMU/Great Eastern/Personal Project/RFM Project/Dataset/search_results_cleaned.xlsx"</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 加载 Excel 文件</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(input_file)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 定义无效内容关键词</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>ad_keywords <span class="op">=</span> [</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"免责声明"</span>, <span class="st">"广告合作"</span>, <span class="st">"联系管理员"</span>, <span class="st">"请在微信中打开"</span>, <span class="st">"本站所有文章"</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"抱歉"</span>, <span class="st">"页面不存在"</span>, <span class="st">"出错"</span>, <span class="st">"404"</span>, <span class="st">"请输入验证码"</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"登录查看全文"</span>, <span class="st">"Oops"</span>, <span class="st">"Something went wrong"</span>, <span class="st">"访问受限"</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 判断是否为无效正文</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_invalid(text):</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(text):</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(text.strip()) <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">any</span>(kw <span class="kw">in</span> text <span class="cf">for</span> kw <span class="kw">in</span> ad_keywords):</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加标记列</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"invalid"</span>] <span class="op">=</span> df[<span class="st">"content"</span>].<span class="bu">apply</span>(is_invalid)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 保留有效正文内容</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>df_cleaned <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">"invalid"</span>]].drop(columns<span class="op">=</span>[<span class="st">"invalid"</span>]).copy()</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存清洗后的结果</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>df_cleaned.to_excel(output_file, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"清洗完成，已保存为：</span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取 Excel 文件</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">"search_results_cleaned.xlsx"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. 查看行数和列数</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"行数 × 列数:"</span>, df.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>行数 × 列数: (90, 6)</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. 查看列名和类型</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">列名与数据类型:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
列名与数据类型:</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>keyword             object
title               object
url                 object
search_timestamp    object
content             object
invalid               bool
dtype: object</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. 快速概览每列的前几行（结构 + 值）</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">样本预览:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
样本预览:</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       keyword  ... invalid
0  中国高净值人士 新加坡  ...   False
1  中国高净值人士 新加坡  ...   False
2  中国高净值人士 新加坡  ...   False
3  中国高净值人士 新加坡  ...   False
4  中国高净值人士 新加坡  ...   False

[5 rows x 6 columns]</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. 缺失值统计（NA 值）</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">缺失值统计:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
缺失值统计:</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.isna().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>keyword             0
title               0
url                 0
search_timestamp    0
content             0
invalid             0
dtype: int64</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_cleaned <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">"invalid"</span>] <span class="op">&amp;</span> df[<span class="st">"content"</span>].notna()].copy()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df_cleaned.to_excel(<span class="st">"search_results_cleaned.xlsx"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="text-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="text-cleaning">Text Cleaning</h2>
<p>The raw text contains punctuation, redundant whitespace, and occasionally malformed encoding. We apply basic cleaning to ensure the corpus is suitable for keyword extraction and topic modeling.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. 加载清洗后的文章数据</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">"Dataset/search_results_cleaned.xlsx"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">"content"</span>].notna() <span class="op">&amp;</span> (df[<span class="st">"content"</span>].<span class="bu">str</span>.strip() <span class="op">!=</span> <span class="st">""</span>)]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. 读取停用词表</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"Dataset/cn_stopwords.txt"</span>, <span class="st">"r"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    stopwords <span class="op">=</span> <span class="bu">set</span>([line.strip() <span class="cf">for</span> line <span class="kw">in</span> f])</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. 清洗函数</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_text(s):</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> re.sub(<span class="vs">r'&lt;.*?&gt;'</span>, <span class="st">''</span>, s)  <span class="co"># HTML标签</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> re.sub(<span class="vs">r'[a-zA-Z]+'</span>, <span class="st">''</span>, s)  <span class="co"># 英文</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> re.sub(<span class="vs">r'[\d\-:/\.年月日\s]+'</span>, <span class="st">''</span>, s)  <span class="co"># 数字与日期</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> re.sub(<span class="vs">r'[\u0000-\u007F]+'</span>, <span class="st">''</span>, s)  <span class="co"># ASCII符号</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s.strip()</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. 分句 + 清洗 + 分词 + 去停用词</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>words <span class="op">=</span> []</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> content <span class="kw">in</span> df[<span class="st">"content"</span>]:</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    sentences <span class="op">=</span> re.split(<span class="vs">r'[。！？]'</span>, content)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> s <span class="kw">in</span> sentences:</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>        s_clean <span class="op">=</span> clean_text(s)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(s_clean) <span class="op">&gt;=</span> <span class="dv">5</span>:</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>            segs <span class="op">=</span> jieba.cut(s_clean)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>            words <span class="op">+=</span> [w <span class="cf">for</span> w <span class="kw">in</span> segs <span class="cf">if</span> <span class="bu">len</span>(w) <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">and</span> w <span class="kw">not</span> <span class="kw">in</span> stopwords <span class="kw">and</span> re.match(<span class="vs">r'[\u4e00-\u9fff]+'</span>, w)]</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. 词频统计</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>word_freq <span class="op">=</span> Counter(words)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>df_freq <span class="op">=</span> pd.DataFrame(word_freq.most_common(<span class="dv">100</span>), columns<span class="op">=</span>[<span class="st">"Word"</span>, <span class="st">"Frequency"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. 保存到文件</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>df_freq.to_excel(<span class="st">"Dataset/word_frequency_cleaned_with_stopwords.xlsx"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. 打印结果</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Word  Frequency
0   新加坡       1895
1    信托       1301
2    家族       1028
3    资产        947
4    投资        922
..  ...        ...
95   方式        133
96   目前        132
97   顾问        132
98   数量        128
99   产品        126

[100 rows x 2 columns]</code></pre>
</div>
</div>
</section>
<section id="keyword-frequency" class="level2">
<h2 class="anchored" data-anchor-id="keyword-frequency">Keyword Frequency</h2>
<p>We extract high-frequency terms to detect common concerns and motivations. This analysis surfaces dominant themes such as “wealth management”, “immigration”, and “Singapore advantage”.</p>
</section>
</section>
<section id="text-analysis" class="level1">
<h1>2 <strong>Text Analysis</strong></h1>
<section id="word-cloud" class="level2">
<h2 class="anchored" data-anchor-id="word-cloud"><strong>2.1 Word Cloud</strong></h2>
</section>
<section id="visualizing-high-frequency-terms" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-high-frequency-terms">Visualizing High-Frequency Terms</h2>
<p>The following word cloud ord highlights the most common terms across all retrieved content, offering a visual snapshot of what matters most to the audience.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. 加载词频数据</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>df_freq <span class="op">=</span> pd.read_excel(<span class="st">"Dataset/word_frequency_cleaned_with_stopwords.xlsx"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. 转换为字典格式</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>freq_dict <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(df_freq[<span class="st">"Word"</span>], df_freq[<span class="st">"Frequency"</span>]))</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. 创建词云对象</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>wc <span class="op">=</span> WordCloud(</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    font_path<span class="op">=</span><span class="st">"/System/Library/Fonts/STHeiti Medium.ttc"</span>,  <span class="co"># 替换为你本地支持中文的字体路径</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    background_color<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">700</span>,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    max_words<span class="op">=</span><span class="dv">200</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>).generate_from_frequencies(freq_dict)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. 可视化词云</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>plt.imshow(wc, interpolation<span class="op">=</span><span class="st">"bilinear"</span>)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(np.float64(-0.5), np.float64(999.5), np.float64(699.5), np.float64(-0.5))</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"WordCloud"</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(top<span class="op">=</span><span class="fl">0.85</span>) </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Market_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Insights from the Word Cloud
</div>
</div>
<div class="callout-body-container callout-body">
<p>The word cloud visually reinforces the central motivations driving Chinese high-net-worth individuals (HNWIs) to move their assets to Singapore.</p>
<ul>
<li>High-frequency terms such as <strong>“财富管理”</strong> (wealth management), <strong>“资产配置”</strong> (asset allocation), and <strong>“税务优化”</strong> (tax optimization) directly align with the motivations outlined in our initial flowchart.</li>
<li>Keywords like <strong>“家族信托”</strong> (family trust), <strong>“离岸账户”</strong> (offshore accounts), and <strong>“子女教育”</strong> (children’s education) indicate a strong emphasis on legacy planning, asset protection, and long-term family welfare.</li>
</ul>
<p><strong>Conclusion</strong>: These themes confirm that Singapore is not just attractive for its financial incentives—but as a comprehensive hub for multi-generational wealth security and elite lifestyle planning.</p>
</div>
</div>
</section>
<section id="sentiment-analysis" class="level2">
<h2 class="anchored" data-anchor-id="sentiment-analysis"><strong>2.2 Sentiment Analysis</strong></h2>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snownlp <span class="im">import</span> SnowNLP</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取已清洗的数据</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">"Dataset/search_results_cleaned.xlsx"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 过滤掉无正文</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">"content"</span>].notna() <span class="op">&amp;</span> (df[<span class="st">"content"</span>].<span class="bu">str</span>.<span class="bu">len</span>() <span class="op">&gt;</span> <span class="dv">30</span>)].copy()</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 情感分析函数（返回值在 0～1 之间，1 越积极）</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_sentiment(text):</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> SnowNLP(text).sentiments</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加情感评分列</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"sentiment_score"</span>] <span class="op">=</span> df[<span class="st">"content"</span>].<span class="bu">apply</span>(get_sentiment)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 分类标签：大于 0.6 为正面，小于 0.4 为负面，其余为中性</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> classify(score):</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> score <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Unknown"</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> score <span class="op">&gt;</span> <span class="fl">0.6</span>:</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Positive"</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> score <span class="op">&lt;</span> <span class="fl">0.4</span>:</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Negative"</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Neutral"</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"sentiment_label"</span>] <span class="op">=</span> df[<span class="st">"sentiment_score"</span>].<span class="bu">apply</span>(classify)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存结果</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>df.to_excel(<span class="st">"Dataset/search_results_sentiment.xlsx"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看统计</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">"sentiment_label"</span>].value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>sentiment_label
Positive    85
Negative     5
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Count sentiment</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>sentiment_counts <span class="op">=</span> df[<span class="st">"sentiment_label"</span>].value_counts()</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set labels and colors</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> sentiment_counts.index.tolist()</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'#4CAF50'</span> <span class="cf">if</span> label <span class="op">==</span> <span class="st">'Positive'</span> <span class="cf">else</span> <span class="st">'#F44336'</span> <span class="cf">for</span> label <span class="kw">in</span> labels]  </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Define explode to slightly offset each slice</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>explode <span class="op">=</span> [<span class="fl">0.05</span>] <span class="op">*</span> <span class="bu">len</span>(labels)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">7</span>), facecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>wedges, texts, autotexts <span class="op">=</span> ax.pie(</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    sentiment_counts,</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>labels,</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>,</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    startangle<span class="op">=</span><span class="dv">140</span>,</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span>colors,</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    explode<span class="op">=</span>explode,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    wedgeprops<span class="op">=</span>{<span class="st">'edgecolor'</span>: <span class="st">'white'</span>, <span class="st">'linewidth'</span>: <span class="dv">2</span>},</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    textprops<span class="op">=</span>{<span class="st">'fontsize'</span>: <span class="dv">13</span>}</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Labels and percentages</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> text <span class="kw">in</span> autotexts:</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    text.set_color(<span class="st">'white'</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    text.set_fontweight(<span class="st">'bold'</span>)</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title with padding</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Sentiment Composition"</span>, fontsize<span class="op">=</span><span class="dv">18</span>, weight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Equal aspect ratio ensures pie is circular</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'equal'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(np.float64(-1.0678605883871746), np.float64(1.132139119268791), np.float64(-1.1383021878878103), np.float64(1.0616974680034947))</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Market_files/figure-html/unnamed-chunk-16-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Insights from Sentiment Analysis
</div>
</div>
<div class="callout-body-container callout-body">
<p>The sentiment analysis reveals a <strong>mixed but insightful emotional tone</strong> surrounding discussions of wealth migration to Singapore.</p>
<ul>
<li>A significant portion of posts are <strong>positive</strong>, reflecting appreciation for Singapore’s legal stability, tax efficiency, and quality of life.</li>
<li>Negative sentiments mainly revolve around <strong>concerns about regulatory changes</strong>, <strong>barriers to entry</strong>, or <strong>uncertainty around immigration pathways</strong>.</li>
<li>Neutral discussions tend to be <strong>informational or comparative</strong>, providing objective assessments of different offshore options.</li>
</ul>
<p><strong>Conclusion</strong>: These findings suggest that while Singapore is generally viewed favorably, there remains a need to <strong>address misconceptions</strong> and <strong>reduce friction in communication</strong> when engaging with HNW prospects.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> <span class="st">'Arial Unicode MS'</span>  </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.unicode_minus'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 分组：统计每个 keyword 下的正负面数量</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>sentiment_by_keyword <span class="op">=</span> df.groupby([<span class="st">'keyword'</span>, <span class="st">'sentiment_label'</span>]).size().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印检查</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sentiment_by_keyword)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>sentiment_label   Negative  Positive
keyword                             
中国 家族信托 新加坡              0        14
中国富人 资产配置 新加坡            1         8
中国富豪 为什么移民新加坡            1         5
中国移民新加坡 财富管理             0        11
中国高净值人士 子女教育 新加坡         0         9
中国高净值人士 新加坡              2        12
中国高净值客户 离岸账户             0        15
新加坡 CRS 避税               1        11</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘图：堆叠柱状图</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>sentiment_by_keyword.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>), color<span class="op">=</span>[<span class="st">"#1f77b4"</span>, <span class="st">"#ff7f0e"</span>])  </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 设置标题和轴标签</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"关键词情感构成"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"关键词"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"文章数量"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 旋转 x 轴文字防止重叠</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(array([0, 1, 2, 3, 4, 5, 6, 7]), [Text(0, 0, '中国 家族信托 新加坡'), Text(1, 0, '中国富人 资产配置 新加坡'), Text(2, 0, '中国富豪 为什么移民新加坡'), Text(3, 0, '中国移民新加坡 财富管理'), Text(4, 0, '中国高净值人士 子女教育 新加坡'), Text(5, 0, '中国高净值人士 新加坡'), Text(6, 0, '中国高净值客户 离岸账户'), Text(7, 0, '新加坡 CRS 避税')])</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 自动布局</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 显示图像</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Market_files/figure-html/unnamed-chunk-17-5.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Next Step: Deep Dive into Negative Sentiments
</div>
</div>
<div class="callout-body-container callout-body">
<p>To strengthen client engagement and tailor advisory strategies, further analysis should focus on <strong>uncovering the root causes behind negative or hesitant views</strong>. Recommended steps include:</p>
<ul>
<li><strong>Thematic Clustering</strong>: Group negative posts into key concerns—e.g., “regulatory fears”, “immigration complexity”, “trust issues”.</li>
<li><strong>Temporal Sentiment Tracking</strong>: Detect if negative sentiment spikes after specific events (e.g., new financial regulations in China).</li>
</ul>
<p>By understanding the friction points in sentiment, Life Inc can refine positioning, improve client confidence, and remove silent blockers in the decision-making journey.</p>
</div>
</div>
</section>
<section id="network-analysis" class="level2">
<h2 class="anchored" data-anchor-id="network-analysis"><strong>2.3 Network Analysis</strong></h2>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> combinations</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 用于存储每句话的关键词</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>keyword_sentences <span class="op">=</span> []</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> content <span class="kw">in</span> df[<span class="st">"content"</span>]:</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    sentences <span class="op">=</span> re.split(<span class="vs">r'[。！？]'</span>, content)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> s <span class="kw">in</span> sentences:</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>        s_clean <span class="op">=</span> clean_text(s)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(s_clean) <span class="op">&gt;=</span> <span class="dv">5</span>:</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>            segs <span class="op">=</span> jieba.cut(s_clean)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>            word_list <span class="op">=</span> [w <span class="cf">for</span> w <span class="kw">in</span> segs <span class="cf">if</span> <span class="bu">len</span>(w) <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">and</span> w <span class="kw">not</span> <span class="kw">in</span> stopwords <span class="kw">and</span> re.match(<span class="vs">r'[\u4e00-\u9fff]+'</span>, w)]</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>            keyword_sentences.append(word_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>top_100_words <span class="op">=</span> <span class="bu">set</span>(df_freq[<span class="st">"Word"</span>])</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>co_occurrence <span class="op">=</span> Counter()</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 只统计 top100 词之间的共现</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> word_list <span class="kw">in</span> keyword_sentences:</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    words_in_top100 <span class="op">=</span> [w <span class="cf">for</span> w <span class="kw">in</span> word_list <span class="cf">if</span> w <span class="kw">in</span> top_100_words]</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pair <span class="kw">in</span> combinations(<span class="bu">set</span>(words_in_top100), <span class="dv">2</span>):  <span class="co"># set 去重</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>        co_occurrence[<span class="bu">tuple</span>(<span class="bu">sorted</span>(pair))] <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.font_manager <span class="im">as</span> fm</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> font <span class="kw">in</span> fm.findSystemFonts(fontpaths<span class="op">=</span><span class="va">None</span>, fontext<span class="op">=</span><span class="st">'ttf'</span>):</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'PingFang'</span> <span class="kw">in</span> font <span class="kw">or</span> <span class="st">'Arial'</span> <span class="kw">in</span> font <span class="kw">or</span> <span class="st">'Hei'</span> <span class="kw">in</span> font:</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(font)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure this exists already</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># co_occurrence = Counter({("word1", "word2"): freq, ...})</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Build DataFrame from co_occurrence</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>edges_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    [(w1, w2, freq) <span class="cf">for</span> (w1, w2), freq <span class="kw">in</span> co_occurrence.items() <span class="cf">if</span> freq <span class="op">&gt;=</span> <span class="dv">20</span>],</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="st">"from"</span>, <span class="st">"to"</span>, <span class="st">"value"</span>]</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to current directory</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>edges_df.to_csv(<span class="st">"edges.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Check result</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(edges_df.head(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  from   to  value
0   全球   金融     44
1   全球  新加坡    181
2  新加坡   金融    100
3   净值  新加坡    113
4   净值   私人     31
5   净值   地区     38
6   净值   国家     32
7   净值   财富    123
8   人士   净值    146
9   净值   报告     50</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.font_manager <span class="im">as</span> fm</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 设置中文字体</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>my_font <span class="op">=</span> fm.FontProperties(fname<span class="op">=</span><span class="st">"/System/Library/Fonts/STHeiti Medium.ttc"</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> my_font.get_name()</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.unicode_minus'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 构建图</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (w1, w2), freq <span class="kw">in</span> co_occurrence.items():</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> freq <span class="op">&gt;=</span> <span class="dv">20</span>:  <span class="co"># 设定共现阈值</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>        G.add_edge(w1, w2, weight<span class="op">=</span>freq)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 可视化绘图</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>pos <span class="op">=</span> nx.spring_layout(G, k<span class="op">=</span><span class="fl">0.5</span>, seed<span class="op">=</span><span class="dv">42</span>)  <span class="co"># 节点布局</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>nx.draw_networkx_nodes(G, pos, node_size<span class="op">=</span><span class="dv">500</span>, node_color<span class="op">=</span><span class="st">'lightblue'</span>)</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>nx.draw_networkx_edges(G, pos, width<span class="op">=</span>[d[<span class="st">'weight'</span>] <span class="op">*</span> <span class="fl">0.3</span> <span class="cf">for</span> _, _, d <span class="kw">in</span> G.edges(data<span class="op">=</span><span class="va">True</span>)], alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>nx.draw_networkx_labels(G, pos, font_size<span class="op">=</span><span class="dv">10</span>, font_family<span class="op">=</span>my_font.get_name())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>{'全球': Text(-0.0842880072427534, 0.17642179336863892, '全球'), '金融': Text(0.05624833749245123, 0.3834226212036606, '金融'), '新加坡': Text(-0.08497404385074436, 0.06066347567584077, '新加坡'), '净值': Text(-0.12316501575028638, 0.06758314042122512, '净值'), '私人': Text(0.4291529391561576, 0.09228889945579109, '私人'), '地区': Text(0.11671761858545471, 0.8328215789655264, '地区'), '国家': Text(-0.09862470217883511, 0.2914083669039099, '国家'), '财富': Text(-0.07332153419506195, -0.01595506949165427, '财富'), '人士': Text(-0.41097066165841434, -0.040305407660239934, '人士'), '报告': Text(-0.7082110990347876, -0.02135728351719375, '报告'), '银行': Text(0.2351141971809941, 0.18242880770496608, '银行'), '资产': Text(0.00576863003990864, -0.07697548958583662, '资产'), '专业': Text(0.34092551958244494, -0.19892352958019727, '专业'), '企业': Text(-0.002426323805060224, 0.24678082221412945, '企业'), '提供': Text(0.2371455838795942, -0.018858103700529184, '提供'), '管理': Text(0.06070441460651799, -0.008835303128911733, '管理'), '环境': Text(-0.7695945468510266, 0.5429038827187079, '环境'), '税收': Text(0.06353293504386714, 0.3274815695170288, '税收'), '家族': Text(-0.0057276376772351185, -0.12619865024682142, '家族'), '办公室': Text(-0.1251832843851663, -0.12033500158408887, '办公室'), '香港': Text(4.313755083802968e-05, 0.03707249675843364, '香港'), '中国': Text(-0.08808825871384614, 0.12436407168880675, '中国'), '计划': Text(-0.5740573364757406, 0.2251158620430338, '计划'), '投资者': Text(-0.6392947207291862, 0.6999131809489467, '投资者'), '资金': Text(0.6321690421302495, 0.06619355526512917, '资金'), '规划': Text(0.3473221115038492, -0.29454185876101524, '规划'), '业务': Text(0.37589990584531413, 0.15179368863324727, '业务'), '方面': Text(-0.3519942058119079, 0.4273625524795799, '方面'), '重要': Text(-0.7319040479750449, 0.18353108060295853, '重要'), '个人': Text(-0.1400673646313397, 0.5727411073020163, '个人'), '拥有': Text(-0.2947749563408743, -0.316267112228499, '拥有'), '国际': Text(0.3876040331993376, 0.009546230064741194, '国际'), '市场': Text(0.16600808190219146, 0.451079027470913, '市场'), '机构': Text(0.3439712165298118, 0.3154922163858356, '机构'), '进行': Text(-0.15110657514162265, 0.2439257401535137, '进行'), '美国': Text(-0.5211834018571875, -0.11091465718174824, '美国'), '投资': Text(-0.03631047914931302, 0.059722957353771214, '投资'), '主要': Text(-0.2600882041806166, -0.09985431289464497, '主要'), '公司': Text(-0.10168993551534859, -0.07074362524264605, '公司'), '法律': Text(0.024728050037416426, -0.4706470161573844, '法律'), '服务': Text(0.18726183004421276, -0.06573570421565414, '服务'), '设立': Text(-0.047012457921708814, -0.24440672827461743, '设立'), '人群': Text(-0.27000540411795776, 0.05107034394187539, '人群'), '需求': Text(-0.10433921035159009, -0.40731132489416866, '需求'), '需要': Text(0.41056301944516166, 0.2796734626476729, '需要'), '海外': Text(0.13115080880618674, -0.1136773771268126, '海外'), '国内': Text(0.3272805410404342, 0.8525681841187821, '国内'), '成为': Text(-0.5013858040469009, 0.09960538158625813, '成为'), '发展': Text(-0.1796399460966992, 0.43904544099784026, '发展'), '行业': Text(0.19329503501919007, -0.7149024341774384, '行业'), '监管': Text(-0.19502236118649272, 0.841900498270216, '监管'), '目前': Text(-0.44985595407173506, -0.6355625619793502, '目前'), '家庭': Text(0.15716853276100706, -0.31823899961044017, '家庭'), '经济': Text(-0.4274792594277936, 0.45762726870229814, '经济'), '超过': Text(-0.75314498246751, 0.08385544981063961, '超过'), '信托': Text(0.17438184102589196, -0.2604210678534205, '信托'), '方式': Text(0.32786644458760134, 0.6391600104236654, '方式'), '选择': Text(-0.35392904415241305, 0.0264699172301304, '选择'), '境外': Text(-0.15596734345267008, -0.6078661216596724, '境外'), '家办': Text(-0.23220868750146498, -0.3959944125101126, '家办'), '包括': Text(0.31728638180474367, 0.09771096931203982, '包括'), '风险': Text(-0.41412911015696996, -0.44793905412447294, '风险'), '影响': Text(-0.5425464095074639, -0.7937098929994423, '影响'), '政策': Text(0.1887002437963138, -0.45248622580216197, '政策'), '相关': Text(-0.40948413865850486, 0.2840612000872398, '相关'), '身份': Text(0.5700620656984552, -0.1667525779370259, '身份'), '方案': Text(0.49110005604537726, -0.3812731093269936, '方案'), '资本': Text(0.45532395626189387, 0.6246757225326001, '资本'), '税务': Text(0.12470219631438775, 0.1465387749062178, '税务'), '增长': Text(-0.17867371712758728, 0.6594538092290321, '增长'), '数量': Text(0.5371770427501534, 0.26914455123166303, '数量'), '税率': Text(0.5748524450367416, 0.5015335546433848, '税率'), '要求': Text(-0.3059954188274524, 0.2710337187761868, '要求'), '居民': Text(0.25882546076038454, 0.4467471313513187, '居民'), '可能': Text(-0.28943286268369683, -0.8260982192957885, '可能'), '配置': Text(0.04369572499136623, -0.30813747426779975, '配置'), '信息': Text(0.05175172454756748, 0.5332683129908465, '信息'), '收入': Text(0.5835836758859314, 0.6290108766515359, '收入'), '一个': Text(-0.2934577047704411, -0.22225815557478162, '一个'), '申请': Text(-0.6286813953176749, -0.29106930093675104, '申请'), '基金': Text(-0.3777673753180892, -0.1463425195879327, '基金'), '移民': Text(0.06330153953516733, -0.23070493240108714, '移民'), '没有': Text(-0.7378798813537407, -0.7960047445460697, '没有'), '教育': Text(-0.4715785531312976, -0.30605002648668866, '教育'), '未来': Text(-0.6710754106250819, 0.37742991831070205, '未来'), '顾问': Text(0.3598440517824097, -0.6121235572332767, '顾问'), '持有': Text(-0.038210676322923215, -0.721297810673328, '持有'), '客户': Text(0.22721713395167756, -0.11627888701891935, '客户'), '规定': Text(0.15623646583349513, -1.0, '规定'), '产品': Text(0.8338880136204145, 0.058107034118190536, '产品'), '环球': Text(0.46001929965593563, -0.515134461143898, '环球'), '离岸': Text(0.12152202057239804, 0.2080647115443526, '离岸'), '金融机构': Text(0.04457603324662054, 0.8386621312441607, '金融机构'), '账户': Text(0.1517331728159757, 0.3544471719005083, '账户'), '交换': Text(0.07799099307208715, 0.7009159593954648, '交换'), '财产': Text(0.5741571575144769, -0.6929282607502738, '财产'), '委托人': Text(0.4848969247043041, -0.7817519740963982, '委托人'), '受托人': Text(0.8557837910978633, -0.891819979082537, '受托人'), '受益人': Text(0.7590085396770473, -0.6206920254723107, '受益人'), '个人简介': Text(0.306689533778002, -0.46815788923412965, '个人简介')}</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Top 100 中文关键词共现网络"</span>, fontproperties<span class="op">=</span>my_font)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(np.float64(-0.9402592723356601), np.float64(1.0264485165824968), np.float64(-1.194519659332472), np.float64(1.0470878434512543))</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Market_files/figure-html/unnamed-chunk-22-7.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visNetwork)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load edge list</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>edges <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"edges.csv"</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>top_edges <span class="ot">&lt;-</span> edges <span class="sc">%&gt;%</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">80</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate unique node list</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>nodes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">unique</span>(<span class="fu">c</span>(edges<span class="sc">$</span>from, edges<span class="sc">$</span>to)))</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Build interactive network</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="fu">visNetwork</span>(nodes, top_edges, <span class="at">width =</span> <span class="st">"800px"</span>, <span class="at">height =</span> <span class="st">"500px"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visEdges</span>(<span class="at">smooth =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visOptions</span>(<span class="at">highlightNearest =</span> <span class="cn">TRUE</span>, <span class="at">nodesIdSelection =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visPhysics</span>(<span class="at">solver =</span> <span class="st">"forceAtlas2Based"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-98899c83c740f9ec9699" style="width:800px;height:500px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-98899c83c740f9ec9699">{"x":{"nodes":{"id":["全球","新加坡","净值","人士","地区","国家","报告","私人","财富","专业","企业","提供","管理","家族","办公室","中国","计划","投资者","金融","资金","业务","规划","方面","个人","国际","市场","进行","美国","机构","主要","投资","公司","人群","国内","成为","发展","海外","设立","行业","监管","目前","家庭","服务","资产","经济","信托","境外","家办","包括","影响","政策","税收","相关","税务","选择","增长","数量","居民","可能","配置","信息","法律","收入","一个","申请","拥有","基金","移民","银行","教育","方式","持有","客户","未来","资本","要求","产品","方案","环球","离岸","身份","税率","账户","交换","金融机构","委托人","受托人","受益人","个人简介","环境","香港","重要","需求","需要","超过","风险","没有","顾问","规定","财产"],"label":["全球","新加坡","净值","人士","地区","国家","报告","私人","财富","专业","企业","提供","管理","家族","办公室","中国","计划","投资者","金融","资金","业务","规划","方面","个人","国际","市场","进行","美国","机构","主要","投资","公司","人群","国内","成为","发展","海外","设立","行业","监管","目前","家庭","服务","资产","经济","信托","境外","家办","包括","影响","政策","税收","相关","税务","选择","增长","数量","居民","可能","配置","信息","法律","收入","一个","申请","拥有","基金","移民","银行","教育","方式","持有","客户","未来","资本","要求","产品","方案","环球","离岸","身份","税率","账户","交换","金融机构","委托人","受托人","受益人","个人简介","环境","香港","重要","需求","需要","超过","风险","没有","顾问","规定","财产"]},"edges":{"from":["办公室","人群","家族","信托","管理","投资","办公室","新加坡","投资","中国","资产","管理","全球","中国","新加坡","家族","净值","海外","人士","家族","新加坡","交换","家族","公司","家族","新加坡","新加坡","信息","个人简介","新加坡","净值","信托","信托","净值","企业","信托","新加坡","净值","账户","办公室","投资","私人","净值","财富","海外","家族","中国","信托","移民","中国","新加坡","信托","国家","提供","中国","新加坡","投资","净值","信托","全球","家办","个人简介","净值","人士","信息","中国","方案","一个","全球","客户","离岸","中国","环球","交换","账户","居民","办公室","税务","客户","提供"],"to":["家族","净值","新加坡","家族","财富","资产","新加坡","香港","新加坡","新加坡","配置","资产","新加坡","净值","资产","设立","资产","资产","净值","资产","管理","信息","管理","新加坡","财富","设立","财富","账户","移民","税收","财富","资产","设立","投资","新加坡","委托人","移民","新加坡","金融","设立","管理","银行","家庭","资产","移民","投资","资产","新加坡","资产","财富","金融","财产","新加坡","服务","人群","选择","移民","家族","受益人","财富","新加坡","环球","客户","新加坡","金融","投资","移民","新加坡","资产","资产","银行","海外","移民","账户","银行","税收","管理","资产","移民","新加坡"],"value":[405,371,256,210,200,198,196,195,194,186,186,184,181,181,173,156,152,152,146,142,141,140,137,134,133,132,131,131,126,124,123,122,120,117,115,115,114,113,113,110,109,108,108,104,104,103,102,102,102,101,100,100,99,98,98,96,96,95,95,94,92,92,91,90,90,89,89,88,87,87,87,86,86,86,85,85,84,84,84,83]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot"},"manipulation":{"enabled":false},"edges":{"smooth":false},"physics":{"solver":"forceAtlas2Based"}},"groups":null,"width":"800px","height":"500px","idselection":{"enabled":true,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Insights from Co-occurrence Keyword Network
</div>
</div>
<div class="callout-body-container callout-body">
<p>This network reveals how important themes surrounding wealth migration to Singapore <strong>co-appear and reinforce each other</strong> in authentic online discussions.</p>
<ul>
<li>Words like <strong>“资产配置”</strong> (asset allocation), <strong>“新加坡”</strong>, and <strong>“家族信托”</strong> frequently co-occur, forming dense hubs of strategic planning.</li>
<li>The structure suggests that users don’t speak of single motivations in isolation — tax planning, family trust, and regulatory considerations are often bundled in the same conversation.</li>
<li>High-degree nodes like <strong>“CRS”</strong>, <strong>“移民”</strong>, and <strong>“离岸账户”</strong> serve as bridges across different topic communities.</li>
</ul>
<p><strong>Conclusion</strong>: These patterns demonstrate that Chinese HNWIs approach offshore wealth management as a <strong>multifaceted decision process</strong>. Singapore is appealing not for a single advantage, but for its ability to address <strong>multiple interconnected concerns</strong> simultaneously.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算节点的度中心性</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>degree_centrality <span class="op">=</span> nx.degree_centrality(G)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 按中心性排序，取前10个关键词</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>top_nodes <span class="op">=</span> <span class="bu">sorted</span>(degree_centrality.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)[:<span class="dv">10</span>]</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印结果</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Top 10 关键词:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Top 10 关键词:</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> word, score <span class="kw">in</span> top_nodes:</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>word<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>score<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>新加坡: 0.919
资产: 0.808
投资: 0.737
净值: 0.646
家族: 0.646
中国: 0.646
全球: 0.576
财富: 0.556
管理: 0.545
信托: 0.515</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> community <span class="im">as</span> community_louvain  <span class="co"># pip install python-louvain</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.cm <span class="im">as</span> cm</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 社区划分</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>partition <span class="op">=</span> community_louvain.best_partition(G)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 设置颜色映射</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>size <span class="op">=</span> <span class="bu">float</span>(<span class="bu">len</span>(<span class="bu">set</span>(partition.values())))</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>pos <span class="op">=</span> nx.spring_layout(G, k<span class="op">=</span><span class="fl">0.5</span>, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [cm.tab20(i <span class="op">/</span> size) <span class="cf">for</span> i <span class="kw">in</span> partition.values()]</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘图</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">12</span>))</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>nx.draw_networkx_nodes(G, pos, node_size<span class="op">=</span><span class="dv">500</span>, node_color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>nx.draw_networkx_edges(G, pos, width<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>nx.draw_networkx_labels(G, pos, font_size<span class="op">=</span><span class="dv">10</span>, font_family<span class="op">=</span><span class="st">'Arial Unicode MS'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>{'全球': Text(-0.0842880072427534, 0.17642179336863892, '全球'), '金融': Text(0.05624833749245123, 0.3834226212036606, '金融'), '新加坡': Text(-0.08497404385074436, 0.06066347567584077, '新加坡'), '净值': Text(-0.12316501575028638, 0.06758314042122512, '净值'), '私人': Text(0.4291529391561576, 0.09228889945579109, '私人'), '地区': Text(0.11671761858545471, 0.8328215789655264, '地区'), '国家': Text(-0.09862470217883511, 0.2914083669039099, '国家'), '财富': Text(-0.07332153419506195, -0.01595506949165427, '财富'), '人士': Text(-0.41097066165841434, -0.040305407660239934, '人士'), '报告': Text(-0.7082110990347876, -0.02135728351719375, '报告'), '银行': Text(0.2351141971809941, 0.18242880770496608, '银行'), '资产': Text(0.00576863003990864, -0.07697548958583662, '资产'), '专业': Text(0.34092551958244494, -0.19892352958019727, '专业'), '企业': Text(-0.002426323805060224, 0.24678082221412945, '企业'), '提供': Text(0.2371455838795942, -0.018858103700529184, '提供'), '管理': Text(0.06070441460651799, -0.008835303128911733, '管理'), '环境': Text(-0.7695945468510266, 0.5429038827187079, '环境'), '税收': Text(0.06353293504386714, 0.3274815695170288, '税收'), '家族': Text(-0.0057276376772351185, -0.12619865024682142, '家族'), '办公室': Text(-0.1251832843851663, -0.12033500158408887, '办公室'), '香港': Text(4.313755083802968e-05, 0.03707249675843364, '香港'), '中国': Text(-0.08808825871384614, 0.12436407168880675, '中国'), '计划': Text(-0.5740573364757406, 0.2251158620430338, '计划'), '投资者': Text(-0.6392947207291862, 0.6999131809489467, '投资者'), '资金': Text(0.6321690421302495, 0.06619355526512917, '资金'), '规划': Text(0.3473221115038492, -0.29454185876101524, '规划'), '业务': Text(0.37589990584531413, 0.15179368863324727, '业务'), '方面': Text(-0.3519942058119079, 0.4273625524795799, '方面'), '重要': Text(-0.7319040479750449, 0.18353108060295853, '重要'), '个人': Text(-0.1400673646313397, 0.5727411073020163, '个人'), '拥有': Text(-0.2947749563408743, -0.316267112228499, '拥有'), '国际': Text(0.3876040331993376, 0.009546230064741194, '国际'), '市场': Text(0.16600808190219146, 0.451079027470913, '市场'), '机构': Text(0.3439712165298118, 0.3154922163858356, '机构'), '进行': Text(-0.15110657514162265, 0.2439257401535137, '进行'), '美国': Text(-0.5211834018571875, -0.11091465718174824, '美国'), '投资': Text(-0.03631047914931302, 0.059722957353771214, '投资'), '主要': Text(-0.2600882041806166, -0.09985431289464497, '主要'), '公司': Text(-0.10168993551534859, -0.07074362524264605, '公司'), '法律': Text(0.024728050037416426, -0.4706470161573844, '法律'), '服务': Text(0.18726183004421276, -0.06573570421565414, '服务'), '设立': Text(-0.047012457921708814, -0.24440672827461743, '设立'), '人群': Text(-0.27000540411795776, 0.05107034394187539, '人群'), '需求': Text(-0.10433921035159009, -0.40731132489416866, '需求'), '需要': Text(0.41056301944516166, 0.2796734626476729, '需要'), '海外': Text(0.13115080880618674, -0.1136773771268126, '海外'), '国内': Text(0.3272805410404342, 0.8525681841187821, '国内'), '成为': Text(-0.5013858040469009, 0.09960538158625813, '成为'), '发展': Text(-0.1796399460966992, 0.43904544099784026, '发展'), '行业': Text(0.19329503501919007, -0.7149024341774384, '行业'), '监管': Text(-0.19502236118649272, 0.841900498270216, '监管'), '目前': Text(-0.44985595407173506, -0.6355625619793502, '目前'), '家庭': Text(0.15716853276100706, -0.31823899961044017, '家庭'), '经济': Text(-0.4274792594277936, 0.45762726870229814, '经济'), '超过': Text(-0.75314498246751, 0.08385544981063961, '超过'), '信托': Text(0.17438184102589196, -0.2604210678534205, '信托'), '方式': Text(0.32786644458760134, 0.6391600104236654, '方式'), '选择': Text(-0.35392904415241305, 0.0264699172301304, '选择'), '境外': Text(-0.15596734345267008, -0.6078661216596724, '境外'), '家办': Text(-0.23220868750146498, -0.3959944125101126, '家办'), '包括': Text(0.31728638180474367, 0.09771096931203982, '包括'), '风险': Text(-0.41412911015696996, -0.44793905412447294, '风险'), '影响': Text(-0.5425464095074639, -0.7937098929994423, '影响'), '政策': Text(0.1887002437963138, -0.45248622580216197, '政策'), '相关': Text(-0.40948413865850486, 0.2840612000872398, '相关'), '身份': Text(0.5700620656984552, -0.1667525779370259, '身份'), '方案': Text(0.49110005604537726, -0.3812731093269936, '方案'), '资本': Text(0.45532395626189387, 0.6246757225326001, '资本'), '税务': Text(0.12470219631438775, 0.1465387749062178, '税务'), '增长': Text(-0.17867371712758728, 0.6594538092290321, '增长'), '数量': Text(0.5371770427501534, 0.26914455123166303, '数量'), '税率': Text(0.5748524450367416, 0.5015335546433848, '税率'), '要求': Text(-0.3059954188274524, 0.2710337187761868, '要求'), '居民': Text(0.25882546076038454, 0.4467471313513187, '居民'), '可能': Text(-0.28943286268369683, -0.8260982192957885, '可能'), '配置': Text(0.04369572499136623, -0.30813747426779975, '配置'), '信息': Text(0.05175172454756748, 0.5332683129908465, '信息'), '收入': Text(0.5835836758859314, 0.6290108766515359, '收入'), '一个': Text(-0.2934577047704411, -0.22225815557478162, '一个'), '申请': Text(-0.6286813953176749, -0.29106930093675104, '申请'), '基金': Text(-0.3777673753180892, -0.1463425195879327, '基金'), '移民': Text(0.06330153953516733, -0.23070493240108714, '移民'), '没有': Text(-0.7378798813537407, -0.7960047445460697, '没有'), '教育': Text(-0.4715785531312976, -0.30605002648668866, '教育'), '未来': Text(-0.6710754106250819, 0.37742991831070205, '未来'), '顾问': Text(0.3598440517824097, -0.6121235572332767, '顾问'), '持有': Text(-0.038210676322923215, -0.721297810673328, '持有'), '客户': Text(0.22721713395167756, -0.11627888701891935, '客户'), '规定': Text(0.15623646583349513, -1.0, '规定'), '产品': Text(0.8338880136204145, 0.058107034118190536, '产品'), '环球': Text(0.46001929965593563, -0.515134461143898, '环球'), '离岸': Text(0.12152202057239804, 0.2080647115443526, '离岸'), '金融机构': Text(0.04457603324662054, 0.8386621312441607, '金融机构'), '账户': Text(0.1517331728159757, 0.3544471719005083, '账户'), '交换': Text(0.07799099307208715, 0.7009159593954648, '交换'), '财产': Text(0.5741571575144769, -0.6929282607502738, '财产'), '委托人': Text(0.4848969247043041, -0.7817519740963982, '委托人'), '受托人': Text(0.8557837910978633, -0.891819979082537, '受托人'), '受益人': Text(0.7590085396770473, -0.6206920254723107, '受益人'), '个人简介': Text(0.306689533778002, -0.46815788923412965, '个人简介')}</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"关键词共现网络中的话题社区"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(np.float64(-0.9402592723356601), np.float64(1.0264485165824968), np.float64(-1.194519659332472), np.float64(1.0470878434512543))</code></pre>
</div>
<details class="code-fold">
<summary>Click to view code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Market_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Insights from Color-Labeled Keyword Communities
</div>
</div>
<div class="callout-body-container callout-body">
<p>The co-occurrence network, enhanced with semantic color tagging, reveals four distinct communities that structure online discussions around wealth migration to Singapore:</p>
<ul>
<li>🌕 <strong>Community 1 (Brown)</strong> focuses on <strong>trust and legal structures</strong>, with keywords like “trust”, “assets”, “fund”, and “legal” — underscoring the importance of compliant, long-term wealth management.</li>
<li>🟢 <strong>Community 2 (Green)</strong> centers around <strong>client advisory and immigration services</strong>, showing that service quality and immigration logistics are major touchpoints for Chinese HNWIs.</li>
<li>🔵 <strong>Community 3 (Blue)</strong> is tied to <strong>cross-border financial assets and tax implications</strong>, with mentions of “Hong Kong”, “tax”, and “net worth” — pointing to regional diversification strategies.</li>
<li>⚫ <strong>Community 4 (Gray)</strong> contains more <strong>generic or connective language</strong>, serving as linguistic bridges in user conversations.</li>
</ul>
<p><strong>Conclusion</strong>: This structured clustering confirms that Chinese HNWIs are not driven by a single reason to move assets offshore. Instead, their motivations form <strong>a multi-layered ecosystem</strong> — blending financial safety, global mobility, tax planning, and trusted advisory. Singapore is uniquely positioned as <strong>a hub that satisfies all these needs simultaneously</strong>.</p>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>3 <strong>Conclusion</strong></h1>
<section id="final-takeaways-why-do-chinese-hnwis-move-their-wealth-to-singapore" class="level2">
<h2 class="anchored" data-anchor-id="final-takeaways-why-do-chinese-hnwis-move-their-wealth-to-singapore">Final Takeaways: Why Do Chinese HNWIs Move Their Wealth to Singapore?</h2>
<p>Through the combined use of structured flowchart thinking and real-world data collection using a customized web crawler, this study provides a grounded answer to our core question.</p>
<section id="key-findings" class="level3">
<h3 class="anchored" data-anchor-id="key-findings">Key Findings:</h3>
<ul>
<li><strong>Wealth Management &amp; Asset Protection</strong>: Terms like “财富管理” (wealth management) and “资产配置” (asset allocation) appeared frequently, highlighting the strong demand for stable and diversified wealth strategies.</li>
<li><strong>Tax Optimization</strong>: Frequent mentions of “税务优化” and “CRS避税” reflect concerns over rising tax scrutiny in China and Singapore’s more favorable policies.</li>
<li><strong>Educational Planning &amp; Family Legacy</strong>: Phrases such as “子女教育” and “家族信托” indicate that many HNWIs are motivated by long-term family goals rather than short-term returns.</li>
<li><strong>Political and Legal Stability</strong>: Although more subtle, the preference for Singapore’s legal infrastructure and business environment emerged from context-rich discussions.</li>
</ul>
</section>
<section id="why-this-method-worked" class="level3">
<h3 class="anchored" data-anchor-id="why-this-method-worked">Why This Method Worked:</h3>
<p>By using a spider to extract public sentiment directly from platforms like Zhihu and Xueqiu, we bypassed the sampling bias of traditional surveys and captured more nuanced and emotionally honest reasons behind wealth relocation behavior.</p>
</section>
</section>
<section id="strategic-implications" class="level2">
<h2 class="anchored" data-anchor-id="strategic-implications">Strategic Implications</h2>
<section id="for-wealth-advisors" class="level3">
<h3 class="anchored" data-anchor-id="for-wealth-advisors">For Wealth Advisors</h3>
<p>Align advisory messaging with clients’ emotional priorities—especially <strong>trust</strong>, <strong>family security</strong>, and <strong>intergenerational control</strong>. Use insights from sentiment clustering to reframe conversations from “products” to “protecting legacy.”</p>
<blockquote class="blockquote">
<p><strong>Example</strong>:<br>
Replace “Let’s set up a trust to reduce tax” with<br>
“Let’s future-proof your family’s assets so your son can inherit them securely—no matter what happens in either country.”</p>
</blockquote>
<hr>
</section>
<section id="for-life-inc" class="level3">
<h3 class="anchored" data-anchor-id="for-life-inc">For Life Inc</h3>
<p>Build <strong>theme-based planning kits</strong> (e.g.&nbsp;Trust + Tax + Education) mapped to the four identified keyword communities. Invest in <strong>bilingual onboarding</strong>, <strong>WeChat-style content formats</strong>, and <strong>cross-border collaboration frameworks</strong> to serve Chinese HNWIs holistically.</p>
<blockquote class="blockquote">
<p><strong>Example</strong>:<br>
Develop a digital <strong>“Singapore Welcome Pack”</strong> with Mandarin guides on:<br>
- How to legally move funds<br>
- Trust structure overview<br>
- PR application tips<br>
Delivered via a mini-site or WeChat-compatible PDF deck.</p>
</blockquote>
<hr>
</section>
<section id="for-company-strategy" class="level3">
<h3 class="anchored" data-anchor-id="for-company-strategy">For Company Strategy</h3>
<p>Establish <strong>modular advisory paths</strong> for three core personas—<strong>Forward Planner</strong>, <strong>Risk Avoider</strong>, and <strong>Legacy Seeker</strong>. Each path should include tax-legal coordination, lifestyle concierge, and asset structuring guidance anchored in Singapore.</p>
<blockquote class="blockquote">
<p><strong>Example</strong>:<br>
Create a <strong>“Legacy Seeker Pathway”</strong>:<br>
- Intro session with bilingual legacy advisor<br>
- Local will &amp; trust setup<br>
- Heir education roadmap (e.g.&nbsp;next-gen wealth workshops)</p>
</blockquote>
<hr>
</section>
<section id="for-survey-research" class="level3">
<h3 class="anchored" data-anchor-id="for-survey-research">For Survey &amp; Research</h3>
<p>Refine <strong>survey instruments</strong> to probe <strong>latent motivations</strong> (e.g.&nbsp;fear of instability, desire for international lifestyle) and validate which <strong>service combinations</strong> resonate most. Use network clusters to shape both question content and option phrasing.</p>
<blockquote class="blockquote">
<p><strong>Example</strong>:<br>
Include a ranking question:<br>
“Which matters more to you in choosing a jurisdiction for your family’s assets?”<br>
(Options: Political stability / Education system / Inheritance clarity / Low tax burden)<br>
→ Each option maps to a keyword community in your analysis.</p>
</blockquote>
<hr>
<p>In conclusion, the answer is not singular—but multi-dimensional. Singapore is attractive to Chinese HNWIs not only for its tax and legal advantages, but because it offers stability, safety, and long-term opportunities for families and wealth.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>